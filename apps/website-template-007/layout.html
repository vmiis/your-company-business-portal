<div content>
    <div content-container id="content_container__ID">
    	<div id=vm_loader class="loader__ID"></div>
    </div>
    <style content-container-css>
    	#content_container__ID{
    		position:fixed;
    		width:100%;
    		overflow:hidden;
    	}
    	#vm_loader{
    		display:none;
    		position:absolute;
    	}
    	.loader__ID {
    	  height: 4px;
    	  width: 100%;
    	  position: relative;
    	  overflow: hidden;
    	  background-color: #ddd;
    	}
    	.loader__ID:before{
    	  display: block;
    	  position: absolute;
    	  content: "";
    	  left: -200px;
    	  width: 200px;
    	  height: 4px;
    	  background-color: #2980b9;
    	  animation: loading 2s linear infinite;
    	}
    	@keyframes loading {
    		from {left: -200px; width: 30%;}
    		50% {width: 30%;}
    		70% {width: 70%;}
    		80% { left: 50%;}
    		95% {left: 120%;}
    		to {left: 100%;}
    	}
    </style>
    <div alert class="modal fade" id="vm_alert_information" tabindex="-1" role="dialog" aria-labelledby="vm_dialog" aria-hidden="true" data-backdrop="static">
    	<div class="modal-dialog" role="document">
    		<div class="modal-content">
    			<div class="modal-header">
    				<h5 class="modal-title" id="ModalLabel">Information</h5>
    				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
    					<span aria-hidden="true">&times;</span>
    				</button>
    			</div>
    			<div class="modal-body">

    			</div>
    			<div class="modal-footer">
    				<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
    			</div>
    		</div>
    	</div>
    </div>
</div>
<script layout-js>
	function vm_layout(){
		//------------------------------------
        $vm.root_layout_content_slot="content_container__ID";
        console.log((new Date().getTime()-$vm.start_time).toString()+"---"+"********************* start running code in main.html ************************");
		//------------------------------------
		window.onmessage=function(e){
		    if(e.data.username!=undefined && e.data.user_id!=undefined){
		        $vm.user=e.data.username;
		        $vm.user_id=e.data.user_id;
		        $VmAPI.set_token(e.data.token,e.data.api_url,e.data.username,e.data.user_id,e.data.nickname);
		        location.reload(true);
		    }
		};
		//-----------------------------------------
		//over write vm alert
		$vm.alert=function(msg){
			$('#vm_alert_information div.modal-body').html( $('<div/>').html(msg).text() );
			$("#vm_alert_information").modal();
		}
        $vm.close_alert=function(){
            $('#vm_alert_information').modal('hide');
		}
		//------------------------------------
		var load_system_modules=function(){
			//-------------------------------------
	        $vm.module_list['_system_export_dialog_module']={table_id:'',url:'__COMPONENT__/dialog/export_dialog_module.html'};
	        $vm.load_module_v2('_system_export_dialog_module','hidden',{})
	        //-------------------------------------
	        $vm.module_list['_system_import_dialog_module']={table_id:'',url:'__COMPONENT__/dialog/import_dialog_module.html'};
	        $vm.load_module_v2('_system_import_dialog_module','hidden',{})
			//-------------------------------------
			$vm.module_list['uploading_file_dialog_module']={table_id:'',url:'__COMPONENT__/dialog/uploading_file_dialog_module.html'};
	        $vm.load_module_v2('uploading_file_dialog_module','hidden',{})
			//-------------------------------------
		}
	}
</script>
<style layout-css>
    .vm_module{
        /*position:absolute;*/
        width:100%;
        height:100%;
    }
	html,body{
		/*height:100%;*/
		/*overflow-y:hidden;*/
        width: 100%;
        height: 100%;
        padding:0;
        margin:0;
        font-family:Arial;
	}
	@keyframes vm_module_fadein {
		from { opacity:0; }
		to {opacity:1;}
	}
    @keyframes vm_module_slide_in {
		from { margin-top:50%; }
		to {margin-top:0;}
	}
    @keyframes vm_module_slide_out {
        from { margin-top:0; }
		to {margin-top:-50%;}
	}
    .ui-widget-content{
        background:#eff3dc!important;
    }
    .ui-autocomplete.ui-menu{font-size:12px}
	.ui-menu-item .ui-menu-item-wrapper:hover{
		font-weight:normal;
	}
    #layout__ID {
        height: 100%;
        display: grid;
        grid-template-rows: auto 1fr auto;
        overflow:hidden;
    }
    @media print {
        html,body{
            width:100%;
            height:100%;
            overflow:visible;
        }
        body * {
            visibility: hidden;
        }
        #content_container_0, #content_container_0 *{
            visibility: visible;
        }
    }
</style>
<script init>
    function vm_init(callback){
        //--------------------------------------------------------
		$vm.start_time=new Date().getTime();
		//check and clear localstorage
		var data=''; for(var key in window.localStorage){ if(window.localStorage.hasOwnProperty(key)){ data+=window.localStorage[key]; }}
		if(data.length>3000000) localStorage.clear();
		if(window.location.href.indexOf('?clearcache=1')!=-1){
			localStorage.clear();
			alert("Cache is cleard!");
			return;
		}
		//set name space
		$VmAPI={};
		//--------------------------------------------------------
		//get hosting path
		var href = window.location.href.split('?')[0];
		var path=href.split('/index.html')[0];
		var lastChar=path[path.length-1];
		if(lastChar=='/') path=path.substring(0,path.length-1);
		$vm.hosting_path=path;
		//if(window.location.hostname=='127.0.0.1' || window.location.hostname=='localhost')	$vm.debug =true;
		//--------------------------------------------------------
		$vm.reload='';
		if(window.location.toString().indexOf('_d=3')!=-1){
			$vm.reload=new Date().getTime().toString();
		}
		$vm.version=$vm.ver[0];
		//--------------------------------------------------------
        $vm.parts_path="https://vmiis.github.io/component";
		if(window.location.hostname=='127.0.0.1' || window.location.hostname=='localhost'){
			$vm.library_path =window.location.protocol+'//'+window.location.host;
		}
		//--------------------------------------------------------
		if($vm.app_config.default_production=='No'){
			if(window.location.toString().indexOf('database=production')!=-1){
				$vm.server          ='production';
				$VmAPI.api_base     =$vm.app_config.api_path_production;
			}
			else{
				$vm.server          ='development';
				$VmAPI.api_base     =$vm.app_config.api_path_development;
			}
		}
		else {
			if(window.location.toString().indexOf('database=development')!=-1){
				$vm.server          ='development';
				$VmAPI.api_base     =$vm.app_config.api_path_development;
			}
			else{
				$vm.server          ='production';
				$VmAPI.api_base     =$vm.app_config.api_path_production;
			}
		}
		$vm.debug_message=true; //show debug message in console
		//--------------------------------------------------------
        //load vm framework, vm api and first module
        var load_vmapi   =function(){ load_js($vm.url('https://vmiis.github.io/api/distribution/vmapi.min.js'),load_vm);	}
        var load_vm      =function(){ load_js($vm.url('https://vmiis.github.io/framework/distribution/vmframework.min.js'),init);}
        var init         =function(){
             $vm.init_v3({callback:function(){
                $vm._id=0;
                $vm.init_status=1;
                over_write_alert();
                setTimeout(function (){	$.ajaxSetup({cache:true}); load_resources(resources); },10);
                callback();
            }})
        }
        //--------------------------------------------------------
        var load_js=function(url,next){
            //this is js loader
            var ver=localStorage.getItem(url+"_ver");
            var txt=localStorage.getItem(url+"_txt");
            //------------------------------------------
            if(ver!=$vm.ver[1] || txt===null || $vm.localhost==true){
                console.log((new Date().getTime()-$vm.start_time).toString()+"---"+'loading '+url+'?_='+$vm.ver[1]);
                $.get(url+'?_='+$vm.reload,function(data){
                    localStorage.setItem(url+"_txt",data);
                    localStorage.setItem(url+"_ver",$vm.ver[1]);
                    $('head').append('<scr'+'ipt>'+data+'</scr'+'ipt>');
                    next();
                },'text');
            }
            else{ $('head').append('<scr'+'ipt>'+txt+'</scr'+'ipt>'); next(); }
            //------------------------------------------
        }
        //--------------------------------------------------------
        $vm.url=function(text){
            text=text.replace(/__HOST__\//g,$vm.hosting_path+'/');
            text=text.replace(/__PARTS__\//g,'https://vmiis.github.io/component/');
            text=text.replace(/__COMPONENT__\//g,'https://vmiis.github.io/component/');
            return text;
        }
        //------------------------------------
        var resources=[
          //"https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css",
          "https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css",
          "https://ajax.aspnetcdn.com/ajax/jquery.ui/1.12.1/themes/redmond/jquery-ui.css",

          "https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js",
          "https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js",
          "https://ajax.aspnetcdn.com/ajax/jquery.ui/1.12.1/jquery-ui.min.js",
          "https://apis.google.com/js/plusone.js",
          "https://ajax.aspnetcdn.com/ajax/jquery.validate/1.14.0/jquery.validate.min.js",
          "https://sdk.amazonaws.com/js/aws-sdk-2.1.34.min.js",
          "https://www.gstatic.com/charts/loader.js"
        ];
        //------------------------------------
        var load_resources=function(links){
          for(i in links){
            var e=links[i].split('.').pop();
            if(e=='css'){
              $('head').append("<link rel='stylesheet' href='"+links[i]+"'>");
            }
            else if(e=='js'){
              load_js_link(links[i])
            }
          }
          var load_system_modules=function(){
              //-------------------------------------
              $vm.module_list['_system_export_dialog_module']={table_id:'',url:'__COMPONENT__/dialog/export_dialog_module.html'};
              $vm.load_module_v2('_system_export_dialog_module','hidden',{})
              //-------------------------------------
              $vm.module_list['_system_import_dialog_module']={table_id:'',url:'__COMPONENT__/dialog/import_dialog_module.html'};
              $vm.load_module_v2('_system_import_dialog_module','hidden',{})
              //-------------------------------------
              $vm.module_list['uploading_file_dialog_module']={table_id:'',url:'__COMPONENT__/dialog/uploading_file_dialog_module.html'};
              $vm.load_module_v2('uploading_file_dialog_module','hidden',{})
              //-------------------------------------
          }
          load_system_modules();
        }
        //------------------------------------
        var load_js_link=function(link){
          $.getScript(link,function(){
            var nm=link.split('/').pop();
            nm=nm.replace(/\./g,'-');
            $vm[nm]=1;
            if(nm=='loader-js'){
              google.charts.load('current', {packages: ['corechart']});
            }
          });
        }
        //------------------------------------
        var over_write_alert=function(){
          //over write vm alert
          $vm.alert=function(msg){
            $('#vm_alert_information div.modal-body').html( $('<div/>').html(msg).text() );
            $("#vm_alert_information").modal();
          }
          $vm.close_alert=function(){
            $('#vm_alert_information').modal('hide');
          }
          //------------------------------------
        }
        load_vmapi();
    }
    //------------------------------------
    //load home module
    var load_home_module=function(){
        console.log((new Date().getTime()-$vm.start_time).toString()+"---"+"********************* loading home module... **************************")
        $vm.load_module_v2('home','',{});
    }
    //------------------------------------
    $vm.app_config={
    	"api_path_development":"https://cbs.wappsystem.com/dev/",
    	"api_path_production":"https://cbs.wappsystem.com/dev/",
    	"default_production":"No",
    	"panels":{
    	}
    }
    vm_init(function(){
        vm_layout();
        load_home_module();
    })
</script>
