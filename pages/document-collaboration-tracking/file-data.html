<section>
      VmInclude:__COMPONENT__/grid/grid.v3.html
</section>
<script>
    function F__ID(){
        //-------------------------------------
        VmInclude:__COMPONENT__/grid/grid.v3.js
        VmInclude:__CURRENT_PATH__/task_data.js
        //-------------------------------------
        var fields="Topic,Document,Last Modified|lastModified,Size,Version,Description";
        _fields="_Form,"+fields+",Submit Date|DateTime,Submitted by|Author,_Delete";
        //-------------------------------------
        $('#save__ID').hide();
        //-------------------------------------
        $('#new__ID').off('click').on('click',function(){
            var record={}
            var input=$vm.vm['__ID'].input;
            var input_record=input.record;
            if(input_record!==undefined){
                record.Topic=input_record.Name;
                record.Topic_uid=input_record.UID;
                record.PUID=input_record.UID;
            }
            $vm.load_module_v2(form_module,'',{record:record,goback:1})
        })
        //-------------------------------------
        _cell_render=function(records,I,field,td,set_value,source){
            switch(field){
                case 'Topic':
                    records[I].vm_readonly[field]=true;
                    break;
                case 'Document':
                    //Vm Include:__COMPONENT__/grid/field_file_with_size.js
                    records[I].vm_readonly[field]=true;
                    if(records[I][field]!=undefined){
                        td.html("<u style='cursor:pointer'>"+records[I][field]+"</u>");
                        td.find('u').on('click',function(){
                            $vm.open_link({rid:records[I].ID,filename:records[I][field]});
                        });
                    }
                    break;
            }
        }
        //-------------------------------------
        _set_req=function(){
            var sql="with tb as (select Information,ID,UID,PUID,DateTime,Author,RowNum=row_number() over (order by ID DESC) from [TABLE-"+_db_pid+"-@S1] )";
            sql+="select Information,ID,UID,PUID,DateTime,Author,RowNum from tb where RowNum between @I6 and @I7";
            var sql_n="select count(ID) from [TABLE-"+_db_pid+"-@S1]";
            //-------------------
            //$('#new__ID').hide();
            var input=$vm.vm['__ID'].input;
            var record=input.record;
            if(record!==undefined){
                if(record.ID!=undefined){
                    var sql_where='puid='+record.UID;
                    sql=sql.replace('RowNum between @I6 and @I7',sql_where);
                    sql_n+=" where "+sql_where;
                }
            }
            //-------------------
        	_req={cmd:'query_records',db_pid:_db_pid,sql:sql,sql_n:sql_n,s1:'"'+$('#keyword__ID').val()+'"',I:$('#I__ID').text(),page_size:$('#page_size__ID').val()}
        }
        //-------------------------------------
    }
</script>
<style>
    VmInclude:__COMPONENT__/grid/grid.v3.css
</style>
